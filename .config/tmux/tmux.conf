# Provides true colour support inside tmux
set-option -g default-terminal "tmux-256color"
set-option -ag terminal-features ",alacritty*:RGB"

# Extra shades of black for Gruvbox
set-option -g @bg1 "#3c3836"
set-option -g @bg2 "#504945"
set-option -g @bg3 "#665c54"

# Set Ctrl+s as prefix instead of Ctrl+b
# All keybinds imply this prefix
# Note: Ctrl+s by default pauses terminal output on bash/zsh, which can be toggled off with Ctrl+q.
# Either change this prefix or disable this keybind on bash (`stty -xion`) or zsh (`unsetopt flow_control`)
unbind-key C-b
set-option -g prefix C-s
bind-key C-s send-prefix

# [hjkl] to move between panes
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# | for left-right split, - for top-bottom split
bind-key | split-window -h
bind-key - split-window -v

# Enter to make new window
bind-key Enter new-window

# Use vi-style key bindings in copy mode
set-option -g mode-keys vi

# Ctrl+u to automatically enter copy mode and scroll up
bind-key C-u copy-mode -u

# Actually use vim keybinds
# For more info on copy/pasting and clipboard, see https://github.com/tmux/tmux/wiki/Clipboard
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Set history limit to 10000 lines
# set-option -g history-limit 10000

# Set window title when tmux is running
set-option -g set-titles on
set-option -g set-titles-string "tmux (#{session_name}): #{pane_title}"

# Index starts from 1 instead of 0
set-option -g base-index 1
set-option -g pane-base-index 1

# Colour the pane border
set-option -g pane-border-style "fg=#{@bg2}"
set-option -g pane-active-border-style "fg=yellow"

# Set pane status format
set-option -g pane-border-format "" # blanks out the pane status line
# set-option -g pane-border-format "#{?pane_active,,#[fg=brightblack]}#{pane_index} \"#{pane_title}\" [#{pane_width}x#{pane_height}]#[default]"

# Put pane border/status at the top
set-option -g pane-border-status top

# Enable only the first status line
set-option -g status on

# Position tmux status bar at the top
set-option -g status-position top

# Set default background/foreground colour as the terminal's
set-option -g status-style "bg=terminal,fg=terminal"

# Set status update interval
set-option -g status-interval 5

# Change formatting for first status line to enable custom window status formats for activity (@window-status-activity-format) and bell alerts (@window-status-bell-format)
set-option -g status-format[0] "#[align=left range=left #{E:status-left-style}]#[push-default]#{T;=/#{status-left-length}:status-left}#[pop-default]#[norange default]"
set-option -ag status-format[0] "#[list=on align=#{status-justify}]#[list=left-marker]<#[list=right-marker]>#[list=on]#{W:#[range=window|#{window_index} #{E:window-status-style}]"
set-option -ag status-format[0] "#{?window_bell_flag,#{?#{!=:#{E:window-status-bell-style},default},#[#{E:window-status-bell-style}],}#[push-default]#{?@window-status-bell-format,#{T:@window-status-bell-format},#{T:window-status-format}},"
set-option -ag status-format[0] "#{?#{||:#{window_activity_flag},#{window_silence_flag}},#{?#{!=:#{E:window-status-activity-style},default},#[#{E:window-status-activity-style}],}#[push-default]#{?@window-status-activity-format,#{T:@window-status-activity-format},#{T:window-status-format}},"
set-option -ag status-format[0] "#{?window_last_flag,#{?#{!=:#{E:window-status-last-style},default},#[#{E:window-status-last-style}],}#[push-default]#{?@window-status-last-format,#{T:@window-status-last-format},#{T:window-status-format}},"
set-option -ag status-format[0] "#[push-default]#{T:window-status-format}}}}#[pop-default]"
set-option -ag status-format[0] "#[norange default]#{?window_end_flag,,#{window-status-separator}},"
set-option -ag status-format[0] "#[range=window|#{window_index} list=focus #{?#{!=:#{E:window-status-current-style},default},#{E:window-status-current-style},#{E:window-status-style}}]"
# The lines below are commented because current flag overrides all other flags (bell, activity etc)
# set-option -ag status-format[0] "#{?window_bell_flag,#{?#{!=:#{E:window-status-bell-style},default},#[#{E:window-status-bell-style}],}#[push-default]#{?@window-status-bell-format,#{T:@window-status-bell-format},#{T:window-status-current-format}},"
# set-option -ag status-format[0] "#{?#{||:#{window_activity_flag},#{window_silence_flag}},#{?#{!=:#{E:window-status-activity-style},default},#[#{E:window-status-activity-style}],}#[push-default]#{?@window-status-activity-format,#{T:@window-status-activity-format},#{T:window-status-current-format}},"
# set-option -ag status-format[0] "#{?window_last_flag,#{?#{!=:#{E:window-status-last-style},default},#[#{E:window-status-last-style}],}#[push-default]#{?@window-status-last-format,#{T:@window-status-last-format},#{T:window-status-current-format}},"
# set-option -ag status-format[0] "#[push-default]#{T:window-status-current-format}}}}#[pop-default]"
set-option -ag status-format[0] "#[push-default]#{T:window-status-current-format}#[pop-default]"
set-option -ag status-format[0] "#[norange list=on default]#{?window_end_flag,,#{window-status-separator}}}"
set-option -ag status-format[0] "#[nolist align=right range=right #{E:status-right-style}]#[push-default]#{T;=/#{status-right-length}:status-right}#[pop-default]#[norange default]"

# Note: "default" colour inherits from a parent option. Use "terminal" for "true" terminal default. See tmux/tmux@fc41bf4
set-option -g status-left "#[bg=green,fg=black,bold] #{l:Session} #[bg=#{@bg1},fg=default,nobold] #S #[bg=default] "
set-option -g status-left-length 50

# Note on blinking: suckless' simple terminal (st) has this weird bug where it refuses to blink text
# on the last line of the screen. Will investigate later. Maybe.
set-option -g window-status-style "fg=brightblack"
set-option -g window-status-activity-style "fg=terminal" # default value is "reverse"
set-option -g window-status-bell-style "default" # default value is "reverse"
set-option -g @window-status-bell-format "#[fg=yellow#,blink][#[noblink]#I:#W#[blink]]#[noblink]"
set-option -g window-status-format " #I:#W "
set-option -g window-status-current-format "#[reverse#,fg=yellow#,bold] #I #[noreverse#,bg=#{@bg1}#,nobold] #W "

# Alternative style (comment out the window status formats above when applying)
# set-option -g window-status-style "reverse,fg=brightblack,bold"
# set-option -g window-status-activity-style "reverse,fg=default,bold"
# set-option -g window-status-bell-style "reverse,fg=red,bold"
# set-option -g window-status-current-style "reverse,fg=yellow,bold"
# set-option -g window-status-format " #I #[noreverse#,bg=#{@bg1},nobold] #W "
# set-option -g window-status-current-format "#{T:window-status-format}"

# set-option -g status-right " #[bg=${bg1}#,fg=terminal] #{=/-75/...:pane_title} #[default] "
set-option -g status-right " #[bg=#{@bg1},fg=brightblack,reverse] CPU #[noreverse] #($HOME/.config/tmux/scripts/status-tmux-cpu) #[default] #[bg=#{@bg1},fg=brightblack,reverse] RAM #[noreverse] #($HOME/.config/tmux/scripts/status-tmux-ram) #[default] #[bg=#{@bg1},fg=brightblack,reverse] Host #[fg=terminal,noreverse] #{=/25/...:host} #[default] #[bg=#{@bg1}] #[fg=yellow]%H#[fg=brightblack]:#[fg=terminal]%M#[fg=brightblack]:%S "
set-option -g status-right-length 100
